<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" class="chrometwo"><head><title>Red Hat Quay Quick Start Guide</title><link rel="stylesheet" type="text/css" href="Common_Content/css/default.css"/><meta name="generator" content="publican v4.3.4"/><meta name="description" content="Red Hat Quay Quick start guide"/><link rel="next" href="#general" title="Chapter 1. General"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><script type="text/javascript" src="Common_Content/scripts/jquery-1.7.1.min.js"> </script><script type="text/javascript" src="Common_Content/scripts/utils.js"> </script><script type="text/javascript" src="Common_Content/scripts/highlight.js/highlight.pack.js"> </script></head><body><div id="chrometwo"><div id="main"><div xml:lang="en-US" class="book" id="idm45766730022480"><div class="titlepage"><div><div class="producttitle"><span class="productname">Red Hat Quay</span> <span class="productnumber">3.5</span></div><div><h1 class="title">Red Hat Quay Quick Start Guide</h1></div><div><h2 class="subtitle">Red Hat Quay Quick start guide</h2></div><div><div xml:lang="en-US" class="authorgroup"><span class="orgname">Red Hat OpenShift Documentation Team</span></div></div><div><a href="#idm45766704832896">Legal Notice</a></div><div><div class="abstract"><p class="title"><strong>Abstract</strong></p><div class="para">
				Red Hat Quay Quick start guide
			</div></div></div></div><hr/></div><div class="toc"><ul class="toc"><li><span class="chapter"><a href="#general">1. General</a></span><ul><li><span class="section"><a href="#using_ssl_to_protect_connections_to_red_hat_quay">1.1. Using SSL to protect connections to Red Hat Quay</a></span><ul><li><span class="section"><a href="#introduction_to_using_ssl">1.1.1. Introduction to using SSL</a></span></li><li><span class="section"><a href="#create-a-ca-and-sign-a-certificate">1.1.2. Create a Certificate Authority and sign a certificate</a></span></li><li><span class="section"><a href="#configuring_ssl_using_the_ui">1.1.3. Configuring SSL using the UI</a></span></li><li><span class="section"><a href="#configuring_ssl_using_the_command_line">1.1.4. Configuring SSL using the command line</a></span></li><li><span class="section"><a href="#testing_ssl_configuration_using_the_command_line">1.1.5. Testing SSL configuration using the command line</a></span></li><li><span class="section"><a href="#testing_ssl_configuration_using_the_browser">1.1.6. Testing SSL configuration using the browser</a></span></li><li><span class="section"><a href="#configuring_podman_to_trust_the_certificate_authority">1.1.7. Configuring podman to trust the Certificate Authority</a></span></li><li><span class="section"><a href="#configuring_the_system_to_trust_the_certificate_authority">1.1.8. Configuring the system to trust the certificate authority</a></span></li></ul></li><li><span class="section"><a href="#quay_superuser">1.2. Quay superuser</a></span><ul><li><span class="section"><a href="#adding_a_superuser_to_quay_using_the_ui">1.2.1. Adding a superuser to Quay using the UI</a></span></li><li><span class="section"><a href="#editing_the_config_yaml_file_to_add_a_superuser">1.2.2. Editing the config.yaml file to add a superuser</a></span></li><li><span class="section"><a href="#accessing_the_superuser_admin_panel">1.2.3. Accessing the superuser admin panel</a></span></li></ul></li><li><span class="section"><a href="#repository_mirroring">1.3. Repository Mirroring</a></span><ul><li><span class="section"><a href="#mirroring-intro">1.3.1. Repository mirroring</a></span></li><li><span class="section"><a href="#mirroring_configuration_ui">1.3.2. Mirroring configuration UI</a></span></li><li><span class="section"><a href="#mirroring-worker">1.3.3. Mirroring worker</a></span></li><li><span class="section"><a href="#mirroring-creating-repo">1.3.4. Creating a mirrored repository</a></span></li><li><span class="section"><a href="#mirroring-tag-patterns">1.3.5. Mirroring tag patterns</a></span></li></ul></li></ul></li></ul></div><section class="chapter" id="general"><div class="titlepage"><div><div><h1 class="title">Chapter 1. General</h1></div></div></div><section class="section" id="using_ssl_to_protect_connections_to_red_hat_quay"><div class="titlepage"><div><div><h2 class="title">1.1. Using SSL to protect connections to Red Hat Quay</h2></div></div></div><section class="section" id="introduction_to_using_ssl"><div class="titlepage"><div><div><h3 class="title">1.1.1. Introduction to using SSL</h3></div></div></div><p>
					To configure Red Hat Quay with a <a class="link" href="https://en.wikipedia.org/wiki/Self-signed_certificate">self-signed certificate</a>, you need to create a Certificate Authority (CA) and then generate the required key and certificate files.
				</p><p>
					The following examples assume you have configured the server hostname <code class="literal">quay-server.example.com</code> using DNS or another naming mechanism, such as adding an entry in your <code class="literal">/etc/hosts</code> file:
				</p><pre class="literallayout">$ cat /etc/hosts
...
192.168.1.112   quay-server.example.com</pre></section><section class="section" id="create-a-ca-and-sign-a-certificate"><div class="titlepage"><div><div><h3 class="title">1.1.2. Create a Certificate Authority and sign a certificate</h3></div></div></div><p>
					At the end of this procedure, you will have a certificate file and a primary key file named <code class="literal">ssl.cert</code> and <code class="literal">ssl.key</code>, respectively.
				</p><section class="section" id="create_a_certificate_authority"><div class="titlepage"><div><div><h4 class="title">1.1.2.1. Create a Certificate Authority</h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
								Generate the root CA key:
							</p><pre class="screen">$ openssl genrsa -out rootCA.key 2048</pre></li><li class="listitem"><p class="simpara">
								Generate the root CA cert:
							</p><pre class="screen">$ openssl req -x509 -new -nodes -key rootCA.key -sha256 -days 1024 -out rootCA.pem</pre></li><li class="listitem"><p class="simpara">
								Enter the information that will be incorporated into your certificate request, including the server hostname, for example:
							</p><pre class="screen">Country Name (2 letter code) [XX]:IE
State or Province Name (full name) []:GALWAY
Locality Name (eg, city) [Default City]:GALWAY
Organization Name (eg, company) [Default Company Ltd]:QUAY
Organizational Unit Name (eg, section) []:DOCS
Common Name (eg, your name or your server's hostname) []:quay-server.example.com</pre></li></ol></div></section><section class="section" id="sign_a_certificate"><div class="titlepage"><div><div><h4 class="title">1.1.2.2. Sign a certificate</h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
								Generate the server key:
							</p><pre class="screen">$ openssl genrsa -out ssl.key 2048</pre></li><li class="listitem"><p class="simpara">
								Generate a signing request:
							</p><pre class="screen">$ openssl req -new -key ssl.key -out ssl.csr</pre></li><li class="listitem"><p class="simpara">
								Enter the information that will be incorporated into your certificate request, including the server hostname, for example:
							</p><pre class="screen">Country Name (2 letter code) [XX]:IE
State or Province Name (full name) []:GALWAY
Locality Name (eg, city) [Default City]:GALWAY
Organization Name (eg, company) [Default Company Ltd]:QUAY
Organizational Unit Name (eg, section) []:DOCS
Common Name (eg, your name or your server's hostname) []:quay-server.example.com</pre></li><li class="listitem"><p class="simpara">
								Create a configuration file <code class="literal">openssl.cnf</code>, specifying the server hostname, for example:
							</p><div class="formalpara"><p class="title"><strong>opensssl.cnf</strong></p><p>
									
<pre class="screen">[req]
req_extensions = v3_req
distinguished_name = req_distinguished_name
[req_distinguished_name]
[ v3_req ]
basicConstraints = CA:FALSE
keyUsage = nonRepudiation, digitalSignature, keyEncipherment
subjectAltName = @alt_names
[alt_names]
DNS.1 = quay-server.example.com
IP.1 = 192.168.1.112</pre>
								</p></div></li><li class="listitem"><p class="simpara">
								Use the configuration file to generate the certificate <code class="literal">ssl.cert</code>:
							</p><pre class="screen">$ openssl x509 -req -in ssl.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out ssl.cert -days 356 -extensions v3_req -extfile openssl.cnf</pre></li></ol></div></section></section><section class="section" id="configuring_ssl_using_the_ui"><div class="titlepage"><div><div><h3 class="title">1.1.3. Configuring SSL using the UI</h3></div></div></div><p>
					This section configures SSL using the Quay UI. To configure SSL using the command line interface, see the following section.
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Start the <code class="literal">Quay</code> container in configuration mode:
						</p><pre class="screen">$ sudo podman run --rm -it --name quay_config -p 80:8080 -p 443:8443 registry.redhat.io/quay/quay-rhel8:v3.5.4 config secret</pre></li><li class="listitem">
							In the Server Configuration section, select <code class="literal">Red Hat Quay handles TLS</code> for TLS. Upload the certificate file and private key file created earlier, ensuring that the Server Hostname matches the value used when creating the certs. Validate and download the updated configuration.
						</li><li class="listitem"><p class="simpara">
							Stop the <code class="literal">Quay</code> container and then restart the registry:
						</p><pre class="screen">$ sudo podman rm -f quay
$ sudo podman run -d --rm -p 80:8080 -p 443:8443 \
--name=quay \
-v $QUAY/config:/conf/stack:Z \
-v $QUAY/storage:/datastorage:Z \
registry.redhat.io/quay/quay-rhel8:v3.5.4</pre></li></ol></div></section><section class="section" id="configuring_ssl_using_the_command_line"><div class="titlepage"><div><div><h3 class="title">1.1.4. Configuring SSL using the command line</h3></div></div></div><p>
					Another option when configuring SSL is to use the command line interface.
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Copy the certificate file and primary key file to your configuration directory, ensuring they are named <code class="literal">ssl.cert</code> and <code class="literal">ssl.key</code> respectively:
						</p><pre class="screen">$ cp ~/ssl.cert $QUAY/config
$ cp ~/ssl.key $QUAY/config
$ cd $QUAY/config</pre></li><li class="listitem"><p class="simpara">
							Edit the <code class="literal">config.yaml</code> file and specify that you want Quay to handle TLS:
						</p><div class="formalpara"><p class="title"><strong>config.yaml</strong></p><p>
								
<pre class="programlisting language-yaml">...
SERVER_HOSTNAME: quay-server.example.com
...
PREFERRED_URL_SCHEME: https
...</pre>
							</p></div></li><li class="listitem"><p class="simpara">
							Stop the <code class="literal">Quay</code> container and restart the registry:
						</p><pre class="screen">$ sudo podman rm -f quay
$ sudo podman run -d --rm -p 80:8080 -p 443:8443 \
  --name=quay \
  -v $QUAY/config:/conf/stack:Z \
  -v $QUAY/storage:/datastorage:Z \
  registry.redhat.io/quay/quay-rhel8:v3.5.4</pre></li></ol></div></section><section class="section" id="testing_ssl_configuration_using_the_command_line"><div class="titlepage"><div><div><h3 class="title">1.1.5. Testing SSL configuration using the command line</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							Use the <code class="literal">podman login</code> command to attempt to log in to the Quay registry with SSL enabled:
						</p><pre class="screen">$ sudo podman login quay-server.example.com
Username: quayadmin
Password:

Error: error authenticating creds for "quay-server.example.com": error pinging docker registry quay-server.example.com: Get "https://quay-server.example.com/v2/": x509: certificate signed by unknown authority</pre></li><li class="listitem"><p class="simpara">
							Podman does not trust self-signed certificates. As a workaround, use the <code class="literal">--tls-verify</code> option:
						</p><pre class="screen">$ sudo podman login --tls-verify=false quay-server.example.com
Username: quayadmin
Password:

Login Succeeded!</pre></li></ul></div><p>
					Configuring Podman to trust the root Certificate Authority (CA) is covered in a subsequent section.
				</p></section><section class="section" id="testing_ssl_configuration_using_the_browser"><div class="titlepage"><div><div><h3 class="title">1.1.6. Testing SSL configuration using the browser</h3></div></div></div><p>
					When you attempt to access the Quay registry, in this case, <code class="literal"><a class="link" href="https://quay-server.example.com">https://quay-server.example.com</a></code>, the browser warns of the potential risk:
				</p><p>
					<span class="inlinemediaobject"><img src="images/ssl-connection-not-private.png" alt="Potential risk"/></span>
				</p><p>
					Proceed to the log in screen, and the browser will notify you that the connection is not secure:
				</p><p>
					<span class="inlinemediaobject"><img src="images/ssl-connection-not-secure.png" alt="Connection not secure"/></span>
				</p><p>
					Configuring the system to trust the root Certificate Authority (CA) is covered in the subsequent section.
				</p></section><section class="section" id="configuring_podman_to_trust_the_certificate_authority"><div class="titlepage"><div><div><h3 class="title">1.1.7. Configuring podman to trust the Certificate Authority</h3></div></div></div><p>
					Podman uses two paths to locate the CA file, namely, <code class="literal">/etc/containers/certs.d/</code> and <code class="literal">/etc/docker/certs.d/</code>.
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							Copy the root CA file to one of these locations, with the exact path determined by the server hostname, and naming the file <code class="literal">ca.crt</code>:
						</p><pre class="screen">$ sudo cp rootCA.pem /etc/containers/certs.d/quay-server.example.com/ca.crt</pre></li><li class="listitem"><p class="simpara">
							Alternatively, if you are using Docker, you can copy the root CA file to the equivalent Docker directory:
						</p><pre class="screen">$ sudo cp rootCA.pem /etc/docker/certs.d/quay-server.example.com/ca.crt</pre></li></ul></div><p>
					You should no longer need to use the <code class="literal">--tls-verify=false</code> option when logging in to the registry:
				</p><pre class="screen">$ sudo podman login quay-server.example.com

Username: quayadmin
Password:
Login Succeeded!</pre></section><section class="section" id="configuring_the_system_to_trust_the_certificate_authority"><div class="titlepage"><div><div><h3 class="title">1.1.8. Configuring the system to trust the certificate authority</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Copy the root CA file to the consolidated system-wide trust store:
						</p><pre class="screen">$ sudo cp rootCA.pem /etc/pki/ca-trust/source/anchors/</pre></li><li class="listitem"><p class="simpara">
							Update the system-wide trust store configuration:
						</p><pre class="screen">$ sudo update-ca-trust extract</pre></li><li class="listitem"><p class="simpara">
							You can use the <code class="literal">trust list</code> command to ensure that the Quay server has been configured:
						</p><pre class="screen">$ trust list | grep quay
    label: quay-server.example.com</pre><p class="simpara">
							Now, when you browse to the registry at <code class="literal"><a class="link" href="https://quay-server.example.com">https://quay-server.example.com</a></code>, the lock icon shows that the connection is secure:
						</p><p class="simpara">
							<span class="inlinemediaobject"><img src="images/ssl-connection-secure.png" alt="Connection not secure"/></span>
						</p></li><li class="listitem"><p class="simpara">
							To remove the root CA from system-wide trust, delete the file and update the configuration:
						</p><pre class="screen">$ sudo rm /etc/pki/ca-trust/source/anchors/rootCA.pem
$ sudo update-ca-trust extract
$ trust list | grep quay
$</pre></li></ol></div><p>
					More information can be found in the RHEL 8 documentation in the chapter <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/security_hardening/using-shared-system-certificates_security-hardening">Using shared system certificates</a>.
				</p></section></section><section class="section" id="quay_superuser"><div class="titlepage"><div><div><h2 class="title">1.2. Quay superuser</h2></div></div></div><p>
				A <code class="literal">superuser</code> is a Quay user account that has extended privileges, including the ability to:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Manage users
					</li><li class="listitem">
						Manage organizations
					</li><li class="listitem">
						Manage service keys
					</li><li class="listitem">
						View the change log
					</li><li class="listitem">
						Query the usage logs
					</li><li class="listitem">
						Create globally visible user messages
					</li></ul></div><section class="section" id="adding_a_superuser_to_quay_using_the_ui"><div class="titlepage"><div><div><h3 class="title">1.2.1. Adding a superuser to Quay using the UI</h3></div></div></div><p>
					This section covers how to add a superuser using the Quay UI. To add a superuser using the command line interface, see the following section.
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Start the <code class="literal">Quay</code> container in configuration mode, loading the existing configuration as a volume:
						</p><pre class="literallayout">$ sudo podman run --rm -it --name quay_config \
  -p 8080:8080 \
  -p 443:8443 \
  -v $QUAY/config:/conf/stack:Z \
  registry.redhat.io/quay/quay-rhel8:v3.5.4 config secret</pre></li><li class="listitem">
							Under the <code class="literal">Access Settings</code> section of the UI, enter the name of the user (in this instance, <code class="literal">quayadmin</code>) in the <code class="literal">Super Users</code> field and click <code class="literal">Add</code>.
						</li><li class="listitem"><p class="simpara">
							Validate and download the <code class="literal">configuration</code> file and then terminate the <code class="literal">Quay</code> container that is running in config mode. Extract the <code class="literal">config.yaml</code> file to the configuration directory and restart the <code class="literal">Quay</code> container in registry mode:
						</p><pre class="screen">$ sudo podman rm -f quay
$ sudo podman run -d --rm -p 80:8080 -p 443:8443 \
--name=quay \
-v $QUAY/config:/conf/stack:Z \
-v $QUAY/storage:/datastorage:Z \
registry.redhat.io/quay/quay-rhel8:v3.5.4</pre></li></ol></div></section><section class="section" id="editing_the_config_yaml_file_to_add_a_superuser"><div class="titlepage"><div><div><h3 class="title">1.2.2. Editing the config.yaml file to add a superuser</h3></div></div></div><p>
					You can also add a superuser by editing the <code class="literal">config.yaml</code> file directly. The list of superuser accounts is stored as an array in the field <code class="literal">SUPER_USERS</code>.
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							Stop the container registry if it is running, and add the <code class="literal">SUPER_USERS</code> array to the <code class="literal">config.yaml</code> file:
						</p><div class="formalpara"><p class="title"><strong>$QUAY/config/config.yaml</strong></p><p>
								
<pre class="programlisting language-yaml">SERVER_HOSTNAME: quay-server.example.com
SETUP_COMPLETE: true
SUPER_USERS:
  - quayadmin
...</pre>
							</p></div></li></ul></div></section><section class="section" id="accessing_the_superuser_admin_panel"><div class="titlepage"><div><div><h3 class="title">1.2.3. Accessing the superuser admin panel</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Restart the Quay registry:
						</p><pre class="screen">$ sudo podman rm -f quay
$ sudo podman run -d --rm -p 80:8080 -p 443:8443 \
--name=quay \
-v $QUAY/config:/conf/stack:Z \
-v $QUAY/storage:/datastorage:Z \
registry.redhat.io/quay/quay-rhel8:v3.5.4</pre></li><li class="listitem"><p class="simpara">
							Access the Super User Admin Panel by clicking on the current user’s name or avatar in the top right-hand corner of the UI. If the user has been added as a superuser, an extra item is presented in the drop-down list called Super User Admin Panel.
						</p><p class="simpara">
							<span class="inlinemediaobject"><img src="images/super-user-admin-panel.png" alt="Super User Admin Panel"/></span>
						</p></li></ol></div><section class="section" id="creating_a_globally_visible_user_message"><div class="titlepage"><div><div><h4 class="title">1.2.3.1. Creating a globally visible user message</h4></div></div></div><p>
						Using the Superuser Admin Panel, you can create <code class="literal">Normal</code>, <code class="literal">Warning</code>, or <code class="literal">Error</code> messages for your organization.
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								Click your user name in the top right-hand corner of the UI. Select <code class="literal">Super User Admin Panel</code>.
							</li><li class="listitem">
								On the Red Hat Quay Management page, click <code class="literal">Globally visible user messages</code> on the left hand pane.
							</li><li class="listitem"><p class="simpara">
								Click <code class="literal">Create Message</code> to show a drop-down menu containing <code class="literal">Normal</code>, <code class="literal">Warning</code>, and <code class="literal">Error</code> message types:
							</p><p class="simpara">
								<span class="inlinemediaobject"><img src="images/create-new-message.png" alt="Creating a new messsage"/></span>
							</p></li><li class="listitem">
								Enter a message by selecting <code class="literal">Click to set message</code>, then click <code class="literal">Create Message</code>.
							</li></ol></div><p>
						Messages can be deleted by clicking <code class="literal">Options</code> and then <code class="literal">Delete Message</code>.
					</p></section></section></section><section class="section" id="repository_mirroring"><div class="titlepage"><div><div><h2 class="title">1.3. Repository Mirroring</h2></div></div></div><section class="section" id="mirroring-intro"><div class="titlepage"><div><div><h3 class="title">1.3.1. Repository mirroring</h3></div></div></div><p>
					Red Hat Quay repository mirroring lets you mirror images from external container registries (or another local registry) into your Red Hat Quay cluster. Using repository mirroring, you can synchronize images to Red Hat Quay based on repository names and tags.
				</p><p>
					From your Red Hat Quay cluster with repository mirroring enabled, you can:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Choose a repository from an external registry to mirror
						</li><li class="listitem">
							Add credentials to access the external registry
						</li><li class="listitem">
							Identify specific container image repository names and tags to sync
						</li><li class="listitem">
							Set intervals at which a repository is synced
						</li><li class="listitem">
							Check the current state of synchronization
						</li></ul></div><p>
					To use the mirroring functionality, you need to:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Enable Repository Mirroring in the Red Hat Quay configuration
						</li><li class="listitem">
							Run a repository mirroring worker
						</li><li class="listitem">
							Create mirrored repositories
						</li></ul></div><p>
					All repository mirroring configuration can be performed using the configuration tool UI or via the Quay API
				</p></section><section class="section" id="mirroring_configuration_ui"><div class="titlepage"><div><div><h3 class="title">1.3.2. Mirroring configuration UI</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Start the <code class="literal">Quay</code> container in configuration mode and select the Enable Repository Mirroring check box. If you want to require HTTPS communications and verify certificates during mirroring, select the HTTPS and cert verification check box.
						</p><p class="simpara">
							<span class="inlinemediaobject"><img src="images/repo_mirror_config.png" alt="Enable mirroring and require HTTPS and verified certificates"/></span>
						</p></li><li class="listitem">
							Validate and download the <code class="literal">configuration</code> file, and then restart Quay in registry mode using the updated config file.
						</li></ol></div></section><section class="section" id="mirroring-worker"><div class="titlepage"><div><div><h3 class="title">1.3.3. Mirroring worker</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							To run the repository mirroring worker, start by running a <code class="literal">Quay</code> pod with the <code class="literal">repomirror</code> option:
						</p><pre class="screen">$ sudo podman run -d --name mirroring-worker \
  -v $QUAY/config:/conf/stack:Z \
  registry.redhat.io/quay/quay-rhel8:v3.5.4 repomirror</pre></li><li class="listitem"><p class="simpara">
							If you have configured TLS communications using a certificate <code class="literal">/root/ca.crt</code>, then the following example shows how to start the mirroring worker:
						</p><pre class="screen">$ sudo podman run -d --name mirroring-worker \
  -v $QUAY/config:/conf/stack:Z \
  -v /root/ca.crt:/etc/pki/ca-trust/source/anchors/ca.crt \
  registry.redhat.io/quay/quay-rhel8:v3.5.4 repomirror</pre></li></ul></div></section><section class="section" id="mirroring-creating-repo"><div class="titlepage"><div><div><h3 class="title">1.3.4. Creating a mirrored repository</h3></div></div></div><p>
					The steps shown in this section assume you already have enabled repository mirroring in the configuration for your Red Hat Quay cluster and that you have a deployed a mirroring worker.
				</p><p>
					When mirroring a repository from an external container registry, create a new private repository. Typically the same name is used as the target repository, for example, <code class="literal">quay-rhel8</code>:
				</p><p>
					<span class="inlinemediaobject"><img src="images/repo_quay_rhel8.png" alt="Create new Red Hat Quay repo"/></span>
				</p><section class="section" id="repository_mirroring_settings"><div class="titlepage"><div><div><h4 class="title">1.3.4.1. Repository mirroring settings</h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
								In the Settings tab, set the Repository State to <code class="literal">Mirror</code>:
							</p><p class="simpara">
								<span class="inlinemediaobject"><img src="images/repo_mirror_create.png" alt="Create a new Red Hat Quay repo mirror"/></span>
							</p></li><li class="listitem"><p class="simpara">
								In the Mirror tab, enter the details for connecting to the external registry, along with the tags, scheduling and access information:
							</p><p class="simpara">
								<span class="inlinemediaobject"><img src="images/repo-mirror-details-start.png" alt="Repository mirroring"/></span>
							</p></li><li class="listitem"><p class="simpara">
								Enter the details as required in the following fields:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										<span class="strong strong"><strong>Registry Location:</strong></span> The external repository you want to mirror, for example, <code class="literal">registry.redhat.io/quay/quay-rhel8</code>
									</li><li class="listitem"><p class="simpara">
										<span class="strong strong"><strong>Tags:</strong></span> This field is required. You may enter a comma-separated list of individual tags or tag patterns. (See <span class="emphasis"><em>Tag Patterns</em></span> section for details.)
									</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
											In order for Quay to get the list of tags in the remote repository, one of the following requirements must be met:
										</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
													An image with the "latest" tag must exist in the remote repository <span class="emphasis"><em>OR</em></span>
												</li><li class="listitem">
													At least one explicit tag, without pattern matching, must exist in the list of tags that you specify
												</li></ul></div></div></div></li><li class="listitem">
										<span class="strong strong"><strong>Start Date:</strong></span> The date on which mirroring begins. The current date and time is used by default.
									</li><li class="listitem">
										<span class="strong strong"><strong>Sync Interval:</strong></span> Defaults to syncing every 24 hours. You can change that based on hours or days.
									</li><li class="listitem">
										<span class="strong strong"><strong>Robot User:</strong></span> Create a new robot account or choose an existing robot account to do the mirroring.
									</li><li class="listitem">
										<span class="strong strong"><strong>Username:</strong></span> The username for accessing the external registry holding the repository you are mirroring.
									</li><li class="listitem">
										<span class="strong strong"><strong>Password:</strong></span> The password associated with the Username. Note that the password cannot include characters that require an escape character (\).
									</li></ul></div></li></ol></div></section><section class="section" id="advanced_settings"><div class="titlepage"><div><div><h4 class="title">1.3.4.2. Advanced settings</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								In the Advanced Settings section, configure TLS and proxy, if required:
							</li><li class="listitem">
								<span class="strong strong"><strong>Verify TLS:</strong></span> Check this box if you want to require HTTPS and to verify certificates, when communicating with the target remote registry.
							</li><li class="listitem">
								<span class="strong strong"><strong>HTTP Proxy:</strong></span> Identify the HTTP proxy server needed to access the remote site, if one is required.
							</li><li class="listitem">
								<span class="strong strong"><strong>HTTPS Proxy:</strong></span> Identify the HTTPS proxy server needed to access the remote site, if one is required.
							</li><li class="listitem">
								<span class="strong strong"><strong>No Proxy:</strong></span> List of locations that do not require proxy
							</li></ul></div></section><section class="section" id="synchronize_now"><div class="titlepage"><div><div><h4 class="title">1.3.4.3. Synchronize now</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								To perform an immediate mirroring operation, press the Sync Now button on the repository’s Mirroring tab. The logs are available on the Usage Logs tab:
							</p><p class="simpara">
								<span class="inlinemediaobject"><img src="images/repo-mirror-usage-logs.png" alt="Usage logs"/></span>
							</p><p class="simpara">
								When the mirroring is complete, the images will appear in the Tags tab:
							</p><p class="simpara">
								<span class="inlinemediaobject"><img src="images/repo-mirror-tags.png" alt="Repository mirroring tags"/></span>
							</p><p class="simpara">
								Below is an example of a completed Repository Mirroring screen:
							</p><p class="simpara">
								<span class="inlinemediaobject"><img src="images/repo-mirror-details.png" alt="Repository mirroring details"/></span>
							</p></li></ul></div></section></section><section class="section" id="mirroring-tag-patterns"><div class="titlepage"><div><div><h3 class="title">1.3.5. Mirroring tag patterns</h3></div></div></div><p>
					As noted above, at least one Tag must be explicitly entered (ie. not a tag pattern) <span class="emphasis"><em>or</em></span> the tag "latest" must exist in the report repository. (The tag "latest" will not be synced unless specified in the tag list.). This is required for Quay to get the list of tags in the remote repository to compare to the specified list to mirror.
				</p><section class="section" id="pattern_syntax"><div class="titlepage"><div><div><h4 class="title">1.3.5.1. Pattern syntax</h4></div></div></div><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><tbody><tr><td align="left" valign="top">
									<p>
										Pattern
									</p>
									</td><td align="left" valign="top">
									<p>
										Description
									</p>
									</td></tr><tr><td align="left" valign="top">
									<p>
										*
									</p>
									</td><td align="left" valign="top">
									<p>
										Matches all characters
									</p>
									</td></tr><tr><td align="left" valign="top">
									<p>
										?
									</p>
									</td><td align="left" valign="top">
									<p>
										Matches any single character
									</p>
									</td></tr><tr><td align="left" valign="top">
									<p>
										[seq]
									</p>
									</td><td align="left" valign="top">
									<p>
										Matches any character in <span class="emphasis"><em>seq</em></span>
									</p>
									</td></tr><tr><td align="left" valign="top">
									<p>
										[!seq]
									</p>
									</td><td align="left" valign="top">
									<p>
										Matches any character not in <span class="emphasis"><em>seq</em></span>
									</p>
									</td></tr></tbody></table></div></section><section class="section" id="example_tag_patterns"><div class="titlepage"><div><div><h4 class="title">1.3.5.2. Example tag patterns</h4></div></div></div><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"/><col style="width: 50%; " class="col_2"/></colgroup><tbody><tr><td align="left" valign="top">
									<p>
										Example Pattern
									</p>
									</td><td align="left" valign="top">
									<p>
										Example Matches
									</p>
									</td></tr><tr><td align="left" valign="top">
									<p>
										v3*
									</p>
									</td><td align="left" valign="top">
									<p>
										v32, v3.1, v3.2, v3.2-4beta, v3.3
									</p>
									</td></tr><tr><td align="left" valign="top">
									<p>
										v3.*
									</p>
									</td><td align="left" valign="top">
									<p>
										v3.1, v3.2, v3.2-4beta
									</p>
									</td></tr><tr><td align="left" valign="top">
									<p>
										v3.?
									</p>
									</td><td align="left" valign="top">
									<p>
										v3.1, v3.2, v3.3
									</p>
									</td></tr><tr><td align="left" valign="top">
									<p>
										v3.[12]
									</p>
									</td><td align="left" valign="top">
									<p>
										v3.1, v3.2
									</p>
									</td></tr><tr><td align="left" valign="top">
									<p>
										v3.[12]*
									</p>
									</td><td align="left" valign="top">
									<p>
										v3.1, v3.2, v3.2-4beta
									</p>
									</td></tr><tr><td align="left" valign="top">
									<p>
										v3.[!1]*
									</p>
									</td><td align="left" valign="top">
									<p>
										v3.2, v3.2-4beta, v3.3
									</p>
									</td></tr></tbody></table></div></section></section></section></section><div><div xml:lang="en-US" class="legalnotice" id="idm45766704832896"><h1 class="legalnotice">Legal Notice</h1><div class="para">
		Copyright <span class="trademark"/>© 2021 Red Hat, Inc.
	</div><div class="para">
		The text of and illustrations in this document are licensed by Red Hat under a Creative Commons Attribution–Share Alike 3.0 Unported license ("CC-BY-SA"). An explanation of CC-BY-SA is available at <a class="uri" href="http://creativecommons.org/licenses/by-sa/3.0/">http://creativecommons.org/licenses/by-sa/3.0/</a>. In accordance with CC-BY-SA, if you distribute this document or an adaptation of it, you must provide the URL for the original version.
	</div><div class="para">
		Red Hat, as the licensor of this document, waives the right to enforce, and agrees not to assert, Section 4d of CC-BY-SA to the fullest extent permitted by applicable law.
	</div><div class="para">
		Red Hat, Red Hat Enterprise Linux, the Shadowman logo, the Red Hat logo, JBoss, OpenShift, Fedora, the Infinity logo, and RHCE are trademarks of Red Hat, Inc., registered in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Linux</span>® is the registered trademark of Linus Torvalds in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Java</span>® is a registered trademark of Oracle and/or its affiliates.
	</div><div class="para">
		<span class="trademark">XFS</span>® is a trademark of Silicon Graphics International Corp. or its subsidiaries in the United States and/or other countries.
	</div><div class="para">
		<span class="trademark">MySQL</span>® is a registered trademark of MySQL AB in the United States, the European Union and other countries.
	</div><div class="para">
		<span class="trademark">Node.js</span>® is an official trademark of Joyent. Red Hat is not formally related to or endorsed by the official Joyent Node.js open source or commercial project.
	</div><div class="para">
		The <span class="trademark">OpenStack</span>® Word Mark and OpenStack logo are either registered trademarks/service marks or trademarks/service marks of the OpenStack Foundation, in the United States and other countries and are used with the OpenStack Foundation's permission. We are not affiliated with, endorsed or sponsored by the OpenStack Foundation, or the OpenStack community.
	</div><div class="para">
		All other trademarks are the property of their respective owners.
	</div></div></div></div></div></div><script type="text/javascript">
                        jQuery(document).ready(function() {
                            initSwitchery();
                            jQuery('pre[class*="language-"]').each(function(i, block){hljs.highlightBlock(block);});
                        });
                    </script></body></html>